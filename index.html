<!DOCTYPE html>
<meta charset="utf-8">

<head>
<meta name="robots" content="noindex">
<title>ARR Dashboard</title>


<!-- Bootstrap core CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.13.0/css/all.css">

<!-- <link href="https://fonts.googleapis.com/css?family=Playfair&#43;Display:700,900&amp;display=swap" rel="stylesheet"> -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&display=swap" rel="stylesheet"> 
<link href="style.css" rel="stylesheet">
</head>

<body>

        
<!-- Create a div where the graph will take place -->

<div class="container">
    <header class="blog-header pb-2 pt-4">
      <div class="row flex-nowrap justify-content-between align-items-center">
        <div class="col-3 pt-1">
          <!-- <a class="link-secondary" href="#">Subscribe</a> -->
        </div>
        <div class="col-6 text-center">
            <div class="row justify-content-center">
                <div class="col-3 align-self-center">
                    <img src="ARR.png" class="img-fluid">
                </div>
            </div>
          <strong><a class="blog-header-logo text-dark pt-2" href="#">Health Dashboard</a></strong>
        </div>
        <div class="col-3 d-flex justify-content-end align-items-center">
          <!-- <a class="link-secondary" href="#" aria-label="Search">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="mx-3" role="img" viewBox="0 0 24 24"><title>Search</title><circle cx="10.5" cy="10.5" r="7.5"/><path d="M21 21l-5.2-5.2"/></svg>
          </a> -->
          <!-- <a class="btn btn-sm btn-outline-secondary" href="#">Sign up</a> -->
        </div>
      </div>
    </header>
    <h2 class="mt-5"><i class="fas fa-chart-line"></i> &nbsp;Overall Statistics</h2>
    <div class="row mt-4">
      <div class="col-12">
        <h4>Number of Submissions</h4>
        <div id="allsubsviz"></div>
      </div>
    </div>
    <div class="row mt-4">
      <div class="col-6">
        <h4>Total and Assigned Area Chairs</h4>
        <div id="aeviz"></div>
      </div>
      <div class="col-6">
        <h4>Total and Assigned Reviewers</h4>
        <div id="revviz"></div>
      </div>
    </div>
    <h2 class="mt-5 pt-5"><i class="fas fa-stream"></i> &nbsp;Individual ARR Iterations</h2>
    <div id="iterations" class="mt-3 row">
        
    </div>



    <footer class="py-3 my-4">
        <!-- <p class="text-center text-muted">University of Washington</p> -->
      </footer>
</div>
</body>
<style>
    .counter {
      color:#999
  }

  .counter-h3 {
      color:#999
  }

  .card-img-top {
    width: 100%;
    /* height: 15vw; */
    object-fit: cover;
    opacity: 0.2;
}
</style>
<!-- JavaScript Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

<!-- Load d3.js -->
<script src="https://d3js.org/d3.v6.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

<script>
var meta_color = "#e64a19"
var review_color = "#1976d2"

var months = [
    ["december", "https://source.unsplash.com/OsNQITphjQQ"],
    ["november", "https://source.unsplash.com/vLbtQEx64RU"],
    ["october", "https://source.unsplash.com/zeInZepl_Hw"],
    ["september", "https://source.unsplash.com/uN0bkEFyhJ8"],
    ["august", "https://source.unsplash.com/znT5MmTjASY"],
    ["july", "https://source.unsplash.com/FCxrLk4-WVY"],
    ["june", "https://source.unsplash.com/RWeO3t9FxG0"],
    ["may", "https://source.unsplash.com/BxT5oqgztNc"]
]

var month_stats = []

$('#iterations').html('')

var total_subs = []
var aes = []
var revs = []
var parseDate = d3.timeParse("%Y-%m-%d");

for (i=0; i < months.length; i++) {
    var submissions = 0
    var review_progress = 0
    var meta_progress = 0
    var k = months[i][0]
    var v = months[i][1]

    $.ajax({
      dataType: "json",
      url: k + '/dashboard_stats.json',
      async: false, 
      success: function(data) {
        submissions = data['submissions']
        review_progress = data['rev-progress']
        meta_progress = data['meta-progress']
        iteration = data['iteration']

        sub_deadline = data['submission-deadline']
        ae_pool = data['ae-pool']
        rev_pool = data['rev-pool']
        ae_assigned = data['ae-assigned']
        rev_assigned = data['rev-assigned']

        total_subs.push({'submissions':submissions, 'month': parseDate(sub_deadline)})
        aes.push({'total': ae_pool, 'assigned': ae_assigned, 'month': parseDate(sub_deadline)})
        revs.push({'total': rev_pool, 'assigned': rev_assigned, 'month': parseDate(sub_deadline)})

        $('#iterations').append(`
                      <div class="col-6">
                      <a href="/arr-health/` + k + `/">
                      <div class="card img-fluid flex-md-row mb-4 shadow h-md-250">
                          <img class="card-img-top" src="` + v + `">
                          <div class="card-img-overlay">
                              <div class="card-body d-flex flex-column align-items-start align-self-end">
                              <h2 class="mb-0">
                                  <strong class="text-dark" href="#">` + iteration + `</strong>
                              </h2>
                              <!-- <div class="mb-1 text-muted">Nov 12</div> -->
                              <h6 class="mt-2 card-text text-dark mb-auto">Submissions: ` + submissions + ` <br> Review Progress: ` + review_progress + `% <br> Meta Review Progress: ` + meta_progress + `%</h6>
                              <!-- <a href="#">Continue reading</a> -->
                              </div>
                          </div>
                      </div>
                      </a>
                      </div>
          `);
      }
    });
};

$(function () {
		      $.each(document.images, function () {
		          var this_image = this;
		          var src = $(this_image).attr('src') || '';
		          if (!src.length > 0) {
		              //this_image.src = options.loading; // show loading
		              var lsrc = $(this_image).attr('lsrc') || '';
		              if (lsrc.length > 0) {
		                  var img = new Image();
		                  img.src = lsrc;
		                  $(img).on('load', function () {
		                      this_image.src = this.src;
		                  });
		              }
		          }
		      });
		  });

function draw_times(selector) {

  margin = {top: 10, right: 30, bottom: 30, left: 40},
      width = 1200 - margin.left - margin.right,
      height = 250 - margin.top - margin.bottom;

  var x = d3.scaleTime()
          .domain([d3.min(total_subs, function(d) {return d.month}), d3.max(total_subs, function(d) {return d.month})])
          .rangeRound([0, width]);

  var y = d3.scaleLinear()
          .domain([0, d3.max(total_subs, function(d) {return d.submissions})])
          .range([height, 0]);

  var svg = d3.select(selector).append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
      .append("g")
      .attr("transform", 
          "translate(" + margin.left + "," + margin.top + ")");

  svg.append("path")
  .datum(total_subs)
  .transition()
  .delay(function(d,i){ return 1000*i; }) 
  .duration(1200)
  .attr("fill", "none")
  .attr("stroke", "#388e3c")
  .attr("stroke-width", 1.5)
  .attr("stroke-linejoin", "round")
  .attr("d",  d3.line()
  .curve(d3.curveBasis)
  .x(function(d) { return x(d.month); })
  .y(function(d) { return y(d.submissions); }));

  svg.append("g")
      .attr("transform", "translate(0," + height + ")")
      .call(d3.axisBottom(x));

  svg.append("g")
      .call(d3.axisLeft(y));
}

draw_times("#allsubsviz")


function draw_reviewers(selector, type) {

  margin = {top: 10, right: 30, bottom: 30, left: 40},
      width = 600 - margin.left - margin.right,
      height = 250 - margin.top - margin.bottom;

  if (type == "review") {
    data = revs
    color = review_color
  } else {
    data = aes
    color = meta_color
  }
  var x = d3.scaleTime()
          .domain([d3.min(data, function(d) {return d.month}), d3.max(data, function(d) {return d.month})])
          .rangeRound([0, width]);

  var y = d3.scaleLinear()
          .domain([0, d3.max(data, function(d) {return d.total})])
          .range([height, 0]);

  var svg = d3.select(selector).append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
      .append("g")
      .attr("transform", 
          "translate(" + margin.left + "," + margin.top + ")");

  svg.append("path")
  .datum(data)
  .transition()
  .delay(function(d,i){ return 1000*i; }) 
  .duration(1200)
  .attr("fill", "none")
  .attr("stroke", "#ddd")
  .attr("stroke-width", 1.5)
  .attr("stroke-linejoin", "round")
  .attr("d",  d3.line()
  .curve(d3.curveBasis)
  .x(function(d) { return x(d.month); })
  .y(function(d) { return y(d.total); }));


  svg.append("path")
  .datum(data)
  .transition()
  .delay(function(d,i){ return 1000*i; }) 
  .duration(1200)
  .attr("fill", "none")
  .attr("stroke", color)
  .attr("stroke-width", 1.5)
  .attr("stroke-linejoin", "round")
  .attr("d",  d3.line()
  .curve(d3.curveBasis)
  .x(function(d) { return x(d.month); })
  .y(function(d) { return y(d.assigned); }));

  svg.append("g")
      .attr("transform", "translate(0," + height + ")")
      .call(d3.axisBottom(x));

  svg.append("g")
      .call(d3.axisLeft(y));
}

draw_reviewers("#aeviz", "meta")
draw_reviewers("#revviz", "review")

</script>

</html>